# 交互式画板应用 - Canvas Sketch

一个基于 Vite + Vue 3 + HTML5 Canvas API 构建的交互式画板应用演示项目。

## 项目结构

```
src/
├── components/
│   ├── CanvasBoard.vue      # 主画板组件（648 行）
│   └── CanvasBoard.css      # 画板样式文件（599 行）
├── utils/
│   └── canvasDrawing.js     # 绘画工具函数模块（188 行）
├── App.vue                  # 根组件
└── main.js                  # 入口文件
```

### 代码组织

- **组件文件**：`CanvasBoard.vue` - 包含模板、脚本和样式引用
- **样式文件**：`CanvasBoard.css` - 所有 CSS 样式独立管理
- **工具模块**：`canvasDrawing.js` - 纯函数绘画逻辑
  - `drawLine()` - 绘制线条
  - `redrawFromStroke()` - 从笔画数据重绘
  - `redrawCanvas()` - 重绘整个画布

## 功能特性

### 核心绘画功能
- ✨ 流畅的鼠标和触摸绘画体验
- 🎨 实时响应用户操作
- 📐 高精度的笔触渲染
- 📱 **移动端触摸支持**：支持手机和平板设备上的绘画操作

### 工具选择
- **画笔工具** 🖌️：用于绘画创作
- **橡皮擦工具** 🧹：用于擦除已绘制的内容

### 画笔设置
- **颜色选择**：使用颜色选择器选择任意颜色
- **大小调整**：通过滑块调整笔刷粗细（1-50px）
- **笔触类型**：支持三种笔触样式
  - 实线：标准的连续线条
  - 虚线：虚线样式的笔触
  - 圆形：圆形笔触效果

### 橡皮擦设置
- **三种大小选项**：
  - 小：10px - 适合精细擦除
  - 中：20px - 适合一般擦除
  - 大：40px - 适合大面积擦除
- **精确擦除**：使用 Canvas 的 destination-out 模式实现精确擦除
- **可序列化**：橡皮擦操作也会被记录到绘画历史中

### 用户界面
- 🎯 清晰的控制面板工具栏
- 🖼️ 全屏 Canvas 绘画区域
- 📱 响应式设计，支持不同屏幕尺寸
- 🌙 **深色主题**：现代化的深色界面设计，参考 VS Code 风格
- 🖥️ **全屏模式**：支持全屏绘画，提供更沉浸的创作体验
- 📱 **手机模式**：专为移动设备优化的绘画模式

### 实用功能
- 🗑️ 清空画布按钮
- 💾 **下载画布为 PNG 图片**：只下载绘画内容，不包含背景图片
- 🎨 **预设背景图片**：从 17 张精美预设图片中选择画布背景，支持在图片上绘画
- 📥 **保存绘画数据**：将绘画记录导出为 JSON 文件
- 📂 **加载绘画数据**：从 JSON 文件还原绘画
- 🖥️ **全屏切换**：一键进入/退出全屏模式
- 📱 **手机模式**：进入全屏并隐藏控制面板，提供四个浮动按钮（返回、清空画布、工具切换、颜色选择）

### 手机模式专属功能
- 🖌️🧹 **工具切换**：在画笔和橡皮擦之间快速切换
- 🎨 **颜色选择器**：弹窗式颜色选择，包含 16 个预设颜色和自定义颜色选择

### 预设背景图片功能
- 🎨 **17 张精美预设图片**：包含可爱动物、机器人、字母等主题
- 🖼️ **4 列网格布局**：清晰展示所有背景图片选项
- 🖱️ **一键选择**：点击图片即可设置为画布背景
- 📱 **响应式设计**：在不同屏幕尺寸下自动调整网格列数（桌面 4 列、平板 3 列、手机 2 列）
- 🎯 **完整显示**：背景图片使用 contain 方式完整显示在画布内，不裁剪图片
- 💾 **独立下载**：下载图片时只保存绘画内容，不包含背景图片

**预设图片列表：**
1. 滑梯上的小猫
2. 机器人猫
3. 简单着色 BB-8
4. xiaoji
5. 可爱的宝宝三角龙
6. 可爱的狐狸给孩子们
7. 可爱的恐龙
8. 可爱的胖刺猬
9. 可爱的 puppy 填色页适合孩子们
10. 可爱的小兔子
11. 可爱的婴儿海龟孵化
12. 可爱的猪仔
13. 可爱海龟在沙滩上
14. 萌萌袋鼠
15. 小海豹
16. 字母R和机器人
17. D代表Daisy

### 数据序列化功能
- 📝 **完整路径记录**：记录每一笔的所有路径点
- 🎨 **笔刷设置保存**：保存每一笔的颜色、大小、样式
- 📊 **画布元数据**：包含画布尺寸、创建时间等信息
- 🔄 **精确还原**：加载后完全还原原始绘画
- 📁 **JSON 格式**：使用标准 JSON 格式，易于分享和处理

## 项目结构

```
canvasSketch/
├── src/
│   ├── components/
│   │   ├── CanvasBoard.vue      # 主画板组件
│   │   └── HelloWorld.vue       # 默认组件（可删除）
│   ├── App.vue                  # 主应用组件
│   ├── main.js                  # 应用入口
│   └── style.css                # 全局样式
├── index.html                   # HTML 入口
├── vite.config.js               # Vite 配置
└── package.json                 # 项目依赖
```

## 快速开始

### 安装依赖
```bash
npm install
```

### 启动开发服务器
```bash
npm run dev
```

然后在浏览器中打开 `http://localhost:5173/`

### 构建生产版本
```bash
npm run build
```

### 预览生产构建
```bash
npm run preview
```

## 使用说明

### 选择工具
1. **画笔工具** 🖌️：点击"画笔"按钮激活绘画模式
2. **橡皮擦工具** 🧹：点击"橡皮擦"按钮激活擦除模式
3. 当前激活的工具会高亮显示

### 绘画操作
1. 选择画笔工具
2. **桌面端**：在 Canvas 区域按住鼠标左键并拖动进行绘画
3. **移动端**：在 Canvas 区域用手指触摸并滑动进行绘画
4. 松开鼠标或手指停止绘画

### 擦除操作
1. 选择橡皮擦工具
2. 选择橡皮擦大小（小/中/大）
3. **桌面端**：在需要擦除的区域按住鼠标左键并拖动
4. **移动端**：在需要擦除的区域用手指触摸并滑动
5. 橡皮擦会将擦除区域恢复为白色背景

### 调整画笔设置（画笔模式下）
1. **颜色**：点击颜色选择器选择颜色
2. **大小**：拖动滑块调整笔刷大小（1-50px）
3. **类型**：从下拉菜单选择笔触样式
   - 实线：标准连续线条
   - 虚线：虚线效果
   - 圆形：圆形笔触

### 调整橡皮擦设置（橡皮擦模式下）
1. **大小**：点击小/中/大按钮选择橡皮擦大小
   - 小：10px - 精细擦除
   - 中：20px - 一般擦除
   - 大：40px - 大面积擦除

### 保存和清空
- 点击"🗑️"按钮清除所有内容
- 点击"💾"按钮将画布保存为 PNG 文件
- 点击"🖼️"按钮上传背景图片
- 点击"📥"按钮将绘画数据导出为 JSON 文件
- 点击"📂"按钮从 JSON 文件还原绘画
- 点击"🖥️"按钮进入全屏模式，按 ESC 键或点击"⛶"按钮退出
- 点击"📱"按钮进入专为移动设备优化的绘画模式

### 手机模式使用
1. **进入手机模式**：
   - 点击控制面板中的"📱"按钮
   - 应用自动进入全屏模式
   - 控制面板隐藏，画布占据整个屏幕
   - 显示四个浮动按钮：
     - 左上角："↩️"（返回）按钮
     - 右上角："🗑️"（清空画布）按钮
     - 左下角："🖌️/🧹"（工具切换）按钮
     - 右下角："🎨"（颜色选择）按钮

2. **手机模式下绘画**：
   - 使用手指在画布上触摸并滑动进行绘画
   - 享受最大化的绘画空间
   - 浮动按钮半透明设计，不会过多遮挡绘画区域

3. **工具切换**：
   - 点击左下角的工具切换按钮在画笔和橡皮擦之间切换
   - 当前是画笔时显示"🧹"图标，点击切换到橡皮擦
   - 当前是橡皮擦时显示"🖌️"图标，点击切换到画笔

4. **颜色选择**：
   - 点击右下角的"🎨"按钮打开颜色选择器
   - 从 16 个预设颜色中选择（4x4 网格布局）
   - 或使用自定义颜色选择器选择任意颜色
   - 点击颜色即可选择并自动关闭弹窗
   - 当前选中的颜色会显示勾选标记

5. **退出手机模式**：
   - 点击左上角的"↩️"按钮
   - 自动退出全屏模式
   - 恢复显示完整的控制面板

### 数据序列化功能使用
1. **保存绘画数据**：
   - 完成绘画后，点击"保存数据"按钮
   - 系统自动生成 JSON 文件并下载
   - 文件包含完整的绘画路径和笔刷设置

2. **加载绘画数据**：
   - 点击"加载数据"按钮
   - 选择之前保存的 JSON 文件
   - 系统自动清空画布并重新绘制
   - 还原后的画面与原始绘画完全一致

3. **数据格式**：
   - 详细的数据格式说明请参考 [DATA_FORMAT.md](./DATA_FORMAT.md)
   - JSON 数据包含画布元数据和所有笔画信息
   - 每一笔都记录了完整的路径点数组

## 技术栈

- **框架**：Vue 3（Composition API）
- **构建工具**：Vite 5
- **绘图**：HTML5 Canvas API
- **样式**：CSS 3（Flexbox、渐变色）
- **语言**：JavaScript（ES6+）

## 浏览器兼容性

- Chrome/Edge 90+
- Firefox 88+
- Safari 14+
- 移动端浏览器（iOS Safari、Chrome Mobile）
- 其他现代浏览器

## 代码特点

### CanvasBoard.vue 组件
- 使用 Vue 3 Composition API
- 完整的鼠标和触摸事件处理
- 支持多种笔触样式和工具
- 响应式设计
- 深色主题 UI（参考 VS Code 风格）
- 全屏模式和手机模式支持
- 中文注释和变量名

### 主要方法
- `initCanvas()`：初始化 Canvas 和上下文
- `drawLine()`：绘制线条，支持不同笔触类型和橡皮擦
- `handleMouseDown/Move/Up()`：处理鼠标事件并记录路径
- `handleTouchStart/Move/End()`：处理触摸事件，支持移动端绘画
- `toggleFullscreen()`：切换全屏模式
- `togglePhoneMode()`：切换手机模式
- `handleFullscreenChange()`：监听全屏状态变化并调整画布
- `clearCanvas()`：清空画布和绘画历史
- `downloadCanvas()`：下载画布为图片
- `saveDrawingData()`：保存绘画数据为 JSON
- `loadDrawingData()`：从 JSON 加载绘画数据
- `redrawFromStroke()`：从笔画数据重新绘制

### 技术亮点
- **深色主题**：采用现代化的深色界面设计，颜色方案参考 VS Code
- **触摸支持**：使用 `touch-action: none` 防止页面滚动，支持移动端流畅绘画
- **全屏 API**：使用 Fullscreen API 实现全屏模式，兼容多种浏览器前缀
- **手机模式**：专为移动设备优化，隐藏控制面板，提供浮动按钮
- **Canvas 状态管理**：使用 `save()` 和 `restore()` 隔离绘图状态
- **橡皮擦实现**：使用 `destination-out` 合成模式实现精确擦除
- **数据序列化**：完整记录绘画路径，支持保存和加载

## 扩展建议

可以进一步扩展的功能：
- 撤销/重做功能
- 形状绘制工具（矩形、圆形等）
- 图层支持
- 笔刷预设
- 导入图片功能
- 多点触控支持（缩放、旋转）
- 压感笔支持

## 许可证

MIT

